<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bonsai IDE</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <h2>
        Bonsai IDE
        <span id="connectionStatus" class="disconnected">‚óã Connecting‚Ä¶</span>
    </h2>

    <div style="margin:6px 0; display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
        <label>LM Studio URL:
            <input id="baseUrlInput" type="text" size="40" placeholder="localhost:1234/v1">
        </label>
        <label>Model:
            <input id="modelInput" type="text" size="40" placeholder="deepseek/deepseek-r1-0528-qwen3-8b">
        </label>
        <button id="btnTestConnection" title="Test connection to LM Studio" aria-label="Test connection to LM Studio">Test Connection</button>
        <span id="connectionTestStatus" aria-live="polite"></span>
    </div>

    <!-- Activity legend -->
    <div class="legend">
        <span class="pill"><span class="swatch gen_tests"></span>Generate tests</span>
        <span class="pill"><span class="swatch refactor"></span>Refactor</span>
        <span class="pill"><span class="swatch exceptions"></span>Handle exceptions</span>
        <span class="pill"><span class="swatch agent_md_alternative"></span>Agent.md alternative</span>
        <span class="pill"><span class="swatch other"></span>Other</span>
        <span class="pill">
            <span class="swatch gradient"></span>Border: Code Similarity (Less ‚Üí More)
        </span>
    </div>

    <!-- Bonsai graph -->
    <div id="graph" style="width:100%; height:500px; border:1px solid #ddd;"></div>

    <button id="btnExportJson" title="Export current Bonsai as JSON">Export JSON</button>
    <button id="btnImportJson" title="Import Bonsai from JSON">Import JSON</button>

    <h2>Agent.md Processing</h2>
    <div style="margin-bottom:4px;">
        <button id="btnLoadAgentMd" title="Load an agent.md file for processing">üìÑ Load Agent.md</button>
        <span id="agentMdFilename" style="margin-left:8px; font-style:italic; color:#666;"></span>
    </div>
    <textarea style="width:100%;" id="agentMdContent" rows="8" cols="60" placeholder="Paste or load your Agent.md content here. This will be processed by the LLM to generate source code."></textarea>
    <div style="margin-top:6px; margin-bottom:12px;">
        <button id="btnProcessAgentMd" class="btn-process-agent" title="Process the Agent.md content with the LLM to generate source code">‚ö° Process Agent.md</button>
        <span id="agentMdProcessStatus" style="margin-left:8px;"></span>
    </div>

    <h2>Generate AGENTS.MD from GitHub Repository</h2>
    <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:8px;">
        <label>GitHub Repository URL:
            <input id="githubRepoUrl" type="text" size="50" placeholder="https://github.com/owner/repo">
        </label>
        <button id="btnGenerateAgentMd" title="Fetch repository from GitHub and generate AGENTS.MD using LLM">üìù Generate AGENTS.MD</button>
        <span id="generateAgentMdStatus" style="margin-left:8px;"></span>
    </div>
    <textarea style="width:100%; display:none;" id="generatedAgentMd" rows="15" cols="60" readonly placeholder="Generated AGENTS.MD content will appear here..."></textarea>

    <h2>Source code of the node selected</h2>
    <textarea style="width:100%;" id="code" rows="10" cols="60"># Paste or type your code here, then select this node and run an activity.</textarea>

    <!-- Collapsible reasoning panel -->
    <details id="reasoningPanel" style="margin-top:8px; display:none;">
        <summary style="cursor:pointer; font-weight:600;">Reasoning</summary>
        <pre id="reasoningContent" class="code-block" style="max-height:280px; overflow:auto; margin-top:6px;"></pre>
    </details>

    <hr>

    <!-- Activities -->
    <h2>Activities</h2>

    <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:8px;">
        <button id="btnGenerateAlternatives" class="btn-activity" data-activity="agent_md_alternative"
            title="Generate multiple alternatives based on Agent.md content">‚ö° Generate Alternatives from Agent.md</button>
        <button id="btnGenTests" class="btn-activity" data-activity="gen_tests"
            title="Generate unit tests">Generate tests</button>
        <button id="btnRefactor" class="btn-activity" data-activity="refactor"
            title="Refactor the code (no behavior change)">Refactor</button>
        <button id="btnExceptions" class="btn-activity" data-activity="exceptions"
            title="Harden exception handling">Handle exceptions</button>
    </div>

    <input hidden id="prompt" type="text" placeholder="Enter prompt" size="60">
    <label>Branches: <input type="number" id="versionCount" value="1" min="1" max="10" style="width:50px;"></label>
    <div id="log"></div>

    <hr>

    <h2>Code Similarity</h2>
    <div style="width:100px;" id="similarities"></div>

    <hr>
    <h2>Code metrics</h2>
    <div id="metrics"></div>

    <hr>
    <h2>Prompts and outputs</h2>
    <div id="output"></div>


    <!-- Cytoscape.js (graph library) -->
    <script src="https://unpkg.com/cytoscape@3.24.0/dist/cytoscape.min.js"></script>
    <!-- BonsAIDE frontend application -->
    <script src="/js/app.js"></script>
</body>

</html>
